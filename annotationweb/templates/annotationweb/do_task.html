{% extends 'annotationweb/two_column_layout.html' %}

{% block javascript %}

initializeAnnotation({{ task.id }}, {{ image.id }});

{% if image_sequence %}
loadSequence(
    {{ image_sequence.id }},
    {{ image_sequence.nr_of_frames }},
    {{ frame_nr }},
    {%  if task.show_entire_sequence %}true{% else %}false{% endif %},
    {{ task.frames_before }},
    {{ task.frames_after }},
    {% if task.auto_play %}true{% else %}false{% endif %}
);
{% endif %}

{# Add label buttons #}
{% for label in task.label.all %}
    addLabelButton({{ label.id }}, {{ label.color_red }}, {{ label.color_green }}, {{ label.color_blue }});
{% endfor %}

{% block task_javascript %}
{% endblock %}

{% if return_url %}
setReturnURL('{{ return_url|safe }}');
{% endif %}

{% endblock javascript %}

{% block content_left %}

{% for message in messages %}
<div{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</div>
{% endfor %}
<div id="message"></div>

<h1>{{ task.name }}</h1>

{{ number_of_labeled_images }} of {{ total_number_of_images}} images has been labeled ({{ percentage_finished }}%).<br />

{% if image_sequence %}
<h2>Sequence</h2>
<div id="progressbar"><div class="progress-label">Loading...</div></div>
<div id="sliderText">Drag the slider to view the other frames in the sequence:</div>
<div id="slider"></div>
<button id="playButton" type="button">Play</button>
<button id="goToTargetFrame">Go to target frame</button>
{% endif %}
<div id="actionButtons">
    <h2>Actions</h2>
    {% if previous_image_id %}
    <button onclick="javascript:changeImage('{% url 'annotate' task.id previous_image_id %}?{{ request.GET.urlencode }}');">Previous</button>
    {% endif %}
    {% if next_image_id %}
    <button onclick="javascript:changeImage('{% url 'annotate' task.id next_image_id %}?{{ request.GET.urlencode }}');">Next</button>
    {% endif %}
    <button id="clearButton">Clear</button>
    {% if next_image_id or previous_image_id %}
    {% else %}
    <button id="skipButton">Skip</button>
    {% endif %}
    <button id="saveButton">Save</button>
    <button onclick="javascript:window.location.href='{% url 'task' task.id %}'">Image list</button>
</div>
<div id="dialogConfirm">
    You have done changes to the annotation. <br>
    Do you wish to save the changes before going to the next/previous image?
</div>
<h2>Annotation</h2>
<div id="imageQuality">
<form id="imageQualityForm">
    Image quality:
    {% for quality_id, quality_name in image_quality_choices %}
    <input type="radio" name="quality" value="{{ quality_id }}" required{% if chosen_quality == quality_id %} checked="checked"{% endif %}> {{ quality_name }}
    {% endfor %}
</form>
</div>

<div id="labelButtons">
{% for label in task.label.all %}
    <button onclick="changeLabel({{ label.id }})" class="labelButton" id="labelButton{{ label.id }}">{{ label.name }}</button>
{% endfor %}
</div>


{% endblock content_left %}
{% block content_right %}

<canvas id="canvas">Failed to show images. Canvas probably not supported in the browser.</canvas>

{% block task_content %}
{% endblock %}

{% if image.metadata_set.count > 0 %}
<h2>Image metadata</h2>
{% for metadata in image.metadata_set.all %}
<strong>{{ metadata.name }}:</strong> {{ metadata.value }}<br>
{% endfor %}
{% endif %}

{% if task.description|length > 0 %}
<h2>Task description</h2>

{{ task.description|safe }}
{% endif %}

{% endblock content_right %}
